
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Backtest com Gr치fico Interativo</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        header {
            background-color: #1f2c3a;
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 1.5rem;
        }
        .container {
            max-width: 960px;
            margin: 2rem auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        .form-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        .form-row label {
            flex: 1;
            margin-right: 1rem;
        }
        .form-row input,
        .form-row select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #chart {
            height: 500px;
        }
    </style>
</head>
<body>
    <header>Backtest com Gr치fico Interativo</header>
    <div class="container">
        <div class="form-row">
            <label>
                Ativo:
                <input type="text" id="symbol" value="GER40" />
            </label>
            <label>
                Tempo Gr치fico:
                <select id="interval">
                    <option value="1">1 minuto</option>
                    <option value="5" selected>5 minutos</option>
                    <option value="15">15 minutos</option>
                    <option value="60">1 hora</option>
                    <option value="D">Di치rio</option>
                </select>
            </label>
        </div>
        <div id="chart"></div>
    </div>

    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        const chart = LightweightCharts.createChart(document.getElementById("chart"), {
            width: document.getElementById("chart").clientWidth,
            height: 500,
            layout: {
                background: { color: "#ffffff" },
                textColor: "#000"
            },
            grid: {
                vertLines: { visible: false },
                horzLines: { visible: false }
            },
            rightPriceScale: {
                borderVisible: false
            },
            timeScale: {
                borderVisible: false
            }
        });

        const candleSeries = chart.addCandlestickSeries();

        async function fetchBars() {
            const symbol = document.getElementById("symbol").value;
            const interval = document.getElementById("interval").value;
            const res = await fetch(`https://api.twelvedata.com/time_series?symbol=${symbol}&interval=${interval}min&outputsize=100&apikey=demo`);
            const data = await res.json();
            if (!data.values) return;

            const bars = data.values.reverse().map(d => ({
                time: new Date(d.datetime).getTime() / 1000,
                open: parseFloat(d.open),
                high: parseFloat(d.high),
                low: parseFloat(d.low),
                close: parseFloat(d.close)
            }));
            candleSeries.setData(bars);
        }

        document.getElementById("symbol").addEventListener("change", fetchBars);
        document.getElementById("interval").addEventListener("change", fetchBars);

        fetchBars();
    </script>
</body>
</html>
